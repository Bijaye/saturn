doctype html
html(ng-app="app")
    head
        include components/jade/header

        script(src="{$ROOT}/components/js/codemirror/codemirror.js")
        script(src="{$ROOT}/components/js/codemirror/mode/javascript/javascript.js")

        // fold code
        script(src='{$ROOT}/components/js/codemirror/addon/fold/foldcode.js')
        script(src='{$ROOT}/components/js/codemirror/addon/fold/foldgutter.js')
        script(src='{$ROOT}/components/js/codemirror/addon/fold/brace-fold.js')
        script(src='{$ROOT}/components/js/codemirror/addon/fold/xml-fold.js')
        script(src='{$ROOT}/components/js/codemirror/addon/fold/markdown-fold.js')
        script(src='{$ROOT}/components/js/codemirror/addon/fold/comment-fold.js')

        link(rel="stylesheet", href="{$ROOT}/components/css/codemirror/codemirror.css")
        link(rel="stylesheet", href="{$ROOT}/components/js/codemirror/addon/fold/foldgutter.css")

        script(src="{$ROOT}/view/js/project.js")
        link(rel="stylesheet", href="{$ROOT}/view/css/project.css")

    body(ng-controller='ctrl')
        .container.top-menu
            nav.navbar.navbar-fixed-top.navbar-light.bg-faded
                .container(ng-cloak)
                    a.navbar-brand(ng-click='titleEdit = true')
                        img(src='/images/saturn-ico.png', width='30', height='30', alt='')
                        span(ng-if='!titleEdit') &nbsp;&nbsp;Saturn: {{app}}
                        input(type='text', ng-if='titleEdit', ng-model='appRename', ng-enter='click.editTitle(appRename)')
                    ul.nav.navbar-nav
                        li.nav-item
                            a.nav-link(ng-click='history()') List

            .toolbar(ng-cloak)
                .container
                    button.btn.btn-default.btn-sm(ng-click='click.run()', ng-cloak, ng-if='ACCESS_STATUS === "GRANTALL"')
                        i.fa.fa-play(ng-if='!status.running')
                        i.fa.fa-stop(ng-if='status.running')
                    button.btn.btn-default.btn-sm(ng-click='click.clean()', ng-if='status.logView == false && ACCESS_STATUS === "GRANTALL"')
                        i.fa.fa-eraser
                    button.btn.btn-default.btn-sm(ng-click='click.save()', ng-if='status.logView == false && ACCESS_STATUS === "GRANTALL"')
                        i.fa.fa-floppy-o
                    button.btn.btn-default.btn-sm(ng-click='click.add()', ng-if='status.logView == false && ACCESS_STATUS === "GRANTALL"')
                        i.fa.fa-plus-square
                    button.btn.btn-default.btn-sm(ng-click='click.remove()', ng-if='status.logView == false && ACCESS_STATUS === "GRANTALL"')
                        i.fa.fa-minus-circle
                    button.btn.btn-default.btn-sm(ng-click='click.export()', ng-if='status.logView == false')
                        i.fa.fa-book
                    button.btn.btn-default.btn-sm(ng-click='click.exportRun()', ng-if='status.logView == false')
                        i.fa.fa-rocket
                    .save-time(style='float: right; font-size: 14px;') {{status.lastSaved}}

            .editor-view(ng-show='status.logView == false', ng-cloak)
                .code-container(ng-cloak, ng-class='status.singleFocused == "libs" && status.running == true ? "running": ""')
                    .row.code-box(ng-click='click.codebox(-1)', ng-class='status.focused == -1 ? "active":""')
                        .col-md-2
                            b in [libs]
                        .col-md-10
                            .code-editor#code-editor-libs

                    .row.code-box.output(ng-if='singleLog.libs && singleLog.libs.length > 0', ng-class='status.focused == $index ? "active":""')
                        .col-md-2(ng-click='outputLong.lib = !outputLong.lib')
                            b out [libs] &nbsp;
                        .col-md-10(ng-class='outputLong.lib ? "" : "scroll"')
                            pre.output-messages
                                div(ng-repeat='log in singleLog.libs', ng-class='log.status') {{log.msg}}

                .code-container(ng-repeat='code in flowpipe track by $index', style='margin-left: {{status.indent[$index]*48}}px;', ng-cloak, ng-class='status.singleFocused == $index && status.running == true ? "running": ""')
                    .row.code-box(ng-click='click.codebox($index)', ng-class='status.focused == $index ? "active":""')
                        .col-md-2
                            b in [{{$index}}] &nbsp;
                            select(ng-model='code.type', ng-change='event.changed()', ng-disabled='code.value != ""')
                                option(value='work') work
                                option(value='loop') loop
                        .col-md-10
                            .loop(ng-if='code.type == "loop"')
                                .row
                                    .col-md-10
                                        .code-editor(id='code-editor-{{code.id}}')
                                    .col-md-2(style='text-align: right;')
                                        | end &nbsp;
                                        select(ng-model='code.block_end', ng-change='event.changed()')
                                            option(ng-repeat='works in loogwork[$index]', value='{{works}}') {{works}}

                            .work(ng-if='code.type == "work"')
                                .code-editor(id='code-editor-{{code.id}}')
                        .col-md-2
                        .col-md-10

                    .row.code-box.output(ng-if='singleLog[$index] && singleLog[$index].length > 0', ng-class='status.focused == $index ? "active":""')
                        .col-md-2(ng-click='outputLong[$index] = !outputLong[$index]')
                            b out [{{$index}}] &nbsp;
                        .col-md-10.col-md-10(ng-class='outputLong[$index] ? "" : "scroll"')
                            pre.output-messages
                                div(ng-repeat='log in singleLog[$index]', ng-class='log.status', ng-bind-html='log.msg')

        .modal.fade#alert(tabindex='-1', role='dialog', aria-labelledby='alert', aria-hidden='true')
            .modal-dialog.modal-sm
                .modal-content
                    .modal-header
                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                            span(aria-hidden='true') Ã—
                        h4.modal-title Alert
                    .modal-body
                        p {{alert.message}}
                    .modal-footer
                        button.btn.btn-secondary(type='button', data-dismiss='modal') Close
